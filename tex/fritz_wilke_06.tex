
\section{Fritz \& Wilke}

\subsection{Delayed Simulation Game}
In this section we consider delayed simulation games and variants thereof on DPAs. This approach is based on the paper \cite{}, which considered the games for alternating parity automata. The DPAs we use are a special case of these APAs and therefore worth examining.

\begin{defn}
	For convenience, we define two orders for this chapter. First, we introduce $\checkmark$ as an \enquote{infinity} to the natural numbers and define the \textbf{obligation order} $\leq_\checkmark \subseteq (\mathbb{N} \cup \{\checkmark\}) \times (\mathbb{N} \cup \{\checkmark\})$ as $0 \leq_\checkmark 1 \leq_\checkmark 2 \leq_\checkmark \dots \leq_\checkmark \checkmark$.
	
	Second, we define an order of \enquote{goodness} on parity priorities $\preceq_\text{p} \subseteq \mathbb{N} \times \mathbb{N}$ as $0 \preceq_\text{p} 2 \preceq_\text{p} 4 \preceq_\text{p} \dots \preceq_\text{p} 5 \preceq_\text{p} 3 \preceq_\text{p} 1$.
\end{defn}

\begin{defn}
	Let $\mathcal{A} = (Q, \Sigma, q_0, \delta, c)$ be a DPA. We define the \emph{delayed simulation automaton} $\mathcal{A}_\text{de}(p, q) = (Q_\text{de}, \Sigma, (p, q, \gamma(c(p), c(q), \checkmark)), \delta_\text{de}, F_\text{de})$, which is a deterministic BÃ¼chi automaton, as follows.
	
	\begin{itemize}
		\item $Q_\text{de} = Q \times Q \times (\text{img}(c) \cup \{ \checkmark \})$, i.e. the states are given as triples in which the first two components are states from $\mathcal{A}$ and the third component is either a priority from $\mathcal{A}$ or $\checkmark$.
		\item The alphabet remains $\Sigma$.
		\item The starting state is a triple $(p, q, \gamma(c(p), c(q), \checkmark))$, where $p, q \in Q$ are parameters given to the automaton, and $\gamma$ is defined below.
		\item $\delta_\text{de}( (p, q, k), a ) = ( p', q', \gamma(c(p'), c(q'), k)$, where $p' = \delta(p, a)$, $q' = \delta(q, a)$, and $\gamma$ is the same function as used in the initial state. The first two components behave like a regular product automaton.
		\item $F_\text{de} = Q \times Q \times \{ \checkmark \}$.
	\end{itemize}
	
	$\gamma : \mathbb{N} \times \mathbb{N} \times (\mathbb{N} \cup \{\checkmark\}) \rightarrow \mathbb{N} \cup \{\checkmark\}$ is the update function of the third component and defines the \enquote{obligations} as they are called in \cite{}. It is defined as 
	$$ \gamma(i, j, k) = \begin{cases}
		\checkmark & \text{if } i \text{ is odd and } i \leq_\checkmark k \text{ and } j \preceq_\text{p} i \\
		\checkmark & \text{if } j \text{ is even and } j \leq_\checkmark k \text{ and } j \preceq_\text{p} i \\
		\min_{\leq_\checkmark} \{ i,j,k \} & \text{else}
	\end{cases} $$
\end{defn}


\begin{defn}
	Let $\mathcal{A}$ be a DPA and let $\mathcal{A}_\text{de}$ be the delayed simulation automaton of $\mathcal{A}$. We say that a state $p$ $de$-simulates a state $q$ if $L(\mathcal{A}_\text{de}(p, q)) = \Sigma^\omega$. In that case we write $p \leq_\text{de} q$. If also $q \leq_\text{de} p$ holds, we write $p \equiv_\text{de} q$.
\end{defn}



\vspace{1cm}
\subsubsection*{$\boldsymbol{\equiv_\text{de}}$ is a congruence relation.}
Our overall goal is to use $\equiv_\text{de}$ to build a quotient automaton of our original DPA. The first step towards this goal is to show that the result is actually a well-defined DPA, by proving that the relation is a congruence.

\begin{lem}
\label{lem:fritzwilke:gamma_mono}
	$\gamma$ is monotonous in the third component, i.e. if $k \leq_\checkmark k'$, then $\gamma(i, j, k) \leq_\checkmark \gamma(i, j, k')$ for all $i, j \in \mathbb{N}$.
\end{lem}

\begin{proof}
	We consider each case in the definition of $\gamma$. If $i$ is odd, $i \leq_\checkmark k$ and $j \preceq_\text{p} i$, then also $i \leq_\checkmark k'$ and $\gamma(i, j, k) = \gamma(i, j, k') = \checkmark$.
	
	If $j$ is even, $j \leq_\checkmark k$ and $j \preceq_\text{p} i$, then also $j \leq_\checkmark k'$ and $\gamma(i, j, k) = \gamma(i, j, k') = \checkmark$.
	
	Otherwise, $\gamma(i, j, k) = \min \{i, j, k\}$ and $\gamma(i, j, k') = \min \{i, j, k'\}$. Since $k \leq_\checkmark k'$, $\gamma(i, j, k) \leq_\checkmark \gamma(i, j, k')$.
\end{proof}

\begin{lem}
\label{lem:fritzwilke:gamma_mono_ext}
	Let $\mathcal{A}$ be a DPA and let $p, q \in Q$, $k \in \mathbb{N} \cup \{\checkmark\}$. If the run of $\mathcal{A}_\text{de}$ starting at $(p, q, k)$ on some $\alpha \in \Sigma^\omega$ is accepting, then for all $k \leq_\checkmark k'$ also the run of $\mathcal{A}_\text{de}$ starting at $(p, q, k')$ on $\alpha$ is accepting.
\end{lem}

\begin{proof}
	Let $\rho$ be the run starting at $(p, q, k)$ and let $\rho'$ be the run starting at $(p, q, k')$. Further, let $p_i$, $q_i$, $k_i$, and $k'_i$ be the components of the states of those runs in the $i$-th step. Via induction we show that $k_i \leq_\checkmark k'_i$ for all $i$. Since $k_i$ is $\checkmark$ infinitely often, the same must be true for $k'_i$ and $\rho'$ is accepting.
	
	For $i = 0$, we have $k_0 = k \leq_\checkmark k' = k'_0$. Otherwise, we have $k_{i+1} = \gamma(c(p_{i+1}), c(q_{i+1}), k_i)$ and $k'_{i+1}$ analogously. The rest follows from Lemma \ref{lem:fritzwilke:gamma_mono}.
\end{proof}

\begin{lem}
\label{lem:fritzwilke:k_shrink}
	Let $\mathcal{A}$ be a DPA and $\rho \in Q_\text{de}^\omega$ be a run of $\mathcal{A}_\text{de}$ on some word. Let $k \in (\mathbb{N} \cup \{\checkmark\})^\omega$ be the third component during $\rho$. For all $i$, $k(i+1) \leq_\checkmark k(i)$ or $k(i+1) = \checkmark$.
\end{lem}

\begin{proof}
	Follows directly from the definition of $\gamma$.
\end{proof}

\begin{lem}
\label{lem:fritzwilke:n0_exists}
	Let $\mathcal{A}$ be a DPA with states $p, q \in Q$. For a word $\alpha \in \Sigma^\omega$, let $\rho : i \mapsto (p_i, q_i, k_i)$ be the run of $\mathcal{A}_\text{de}(p, q)$ on $\alpha$. If $\rho$ is not accepting, there is a position $n$ such that
	\begin{itemize}
		\item $\text{Occ}(\{p_i \mid i \geq n\}) = \text{Inf}(\{p_i \mid i \in \mathbb{N}\})$,
		\item $\text{Occ}(\{q_i \mid i \geq n\}) = \text{Inf}(\{q_i \mid i \in \mathbb{N}\})$,
		\item For all $i \geq j \geq n$, $k_i = k_j$ and $k_i \neq \checkmark$.
	\end{itemize}
	
	In other words, from $n$ on, $p$ and $q$ only see states that are seen infinitely often, and the obligations of $\rho$ do not change anymore.
\end{lem}

\begin{proof}
	The first two requirements are clear. Since states not in $\text{Inf}(\{p_i \mid i \in \mathbb{N}\})$ only occur finitely often, there must be positions $n_p$ and $n_q$ from which on they do not occur anymore at all.
	
	For the third requirement, we know that from some point on, the obligations $k$ never become $\checkmark$ anymore, as the run would be accepting otherwise. By Lemma \ref{lem:fritzwilke:k_shrink}, $k$ can only become lower from there on. As $\leq_\checkmark$ is a well-ordering, a minimum must be reached at some point $n_k$.
	
	The position $n_0 = \max \{n_p, n_q, n_k\}$ satisfies the statement.
\end{proof}

\begin{lem}
\label{lem:fritzwilke:run_goodness_implies_de}
	Let $\mathcal{A}$ be a DPA with two states $p, q \in Q$. Let $\alpha \in \Sigma^\omega$ be an $\omega$-word and let $\rho_p$ and $\rho_q$ be the respective runs of $\mathcal{A}$ on $\alpha$ starting in $p$ and $q$. If $\min \text{Inf}(c(\rho_q)) \preceq_p \min \text{Inf}(c(\rho_p))$, then $\alpha \in L(\mathcal{A}_\text{de}(p, q))$.
\end{lem}

\begin{proof}
	We write $l_q = \min \text{Inf}(c(\rho_q))$ and $l_p = \min \text{Inf}(c(\rho_p))$. Assume that the Lemma is false, so $l_q \preceq_p l_p$ but $\alpha \notin L(\mathcal{A}_\text{de}(p, q))$. Let $k_{13} \in (\mathbb{N} \cup \{\checkmark\})^\omega$ be the third component of the run of $\mathcal{A}_\text{de}(p, q)$ on $\alpha$. Let $n_0$ be a position as described in Lemma \ref{lem:fritzwilke:n0_exists} (for $\rho$). 
	
	\paragraph{Case 1: $l_q$ is even and $l_q \leq l_p$} We know $k_{13}(n_0) = l_q$, as that is the smaller value. Let $m > n_0$ be a position with $c(\rho_q(m)) = l_q$. Then $c(\rho_q(m))$ is even and $c(\rho_q(m)) = l_q \leq l_p \leq c(\rho_p(m))$, so $c(\rho_q(m)) \preceq_p c(\rho_p(m))$. Also we have $c(\rho_q(m)) \leq k_{13}(m-1) = l_q$ and therefore $k_{13}(m) = \checkmark$, which contradicts the choice of $n_0$.
	
	\paragraph{Case 2: $l_p$ is odd and $l_q \geq l_p$} We know $k_{13}(n_0) = l_p$. Let $m > n_0$ be a position with $c(\rho_p(m)) = l_p$. Then $c(\rho_p(m))$ is odd and $c(\rho_p(m)) = l_p \leq l_q \leq c(\rho_q(m))$, so $c(\rho_q(m)) \preceq_p c(\rho_p(m))$. By the same argumentation as above, we deduce $k_{13}(m) = \checkmark$.
\end{proof}

\begin{lem}
\label{lem:fritzwilke:de_order_reftran}
	Let $\mathcal{A}$ be a DPA. Then $\leq_\text{de}$ is reflexive and transitive.
\end{lem}

\begin{proof}
	For reflexivitiy, we need to show that $q \leq_\text{de} q$ for all states $q$. This is rather easy to see. For a word $\alpha \in \Sigma^\omega$, the third component of states in the run of $\mathcal{A}_\text{de}(q, q)$ on $\alpha$ is always $\checkmark$, as $\gamma(i, i, \checkmark) = \checkmark$.
	
	For transitivity, let $q_1 \leq_\text{de} q_2$ and $q_2 \leq_\text{de} q_3$. Assume towards a contradiction that $q_1 \not\leq_\text{de} q_3$, so there is a word $\alpha \notin L(\mathcal{A}_\text{de}(q_1, q_3))$. We consider the three runs $\rho_{12}$, $\rho_{23}$, and $\rho_{13}$ of $\mathcal{A}_\text{de}(q_1, q_2)$, $\mathcal{A}_\text{de}(q_2, q_3)$, and $\mathcal{A}_\text{de}(q_1, q_3)$ respectively on $\alpha$. Then $\rho_{12}$ and $\rho_{23}$ are accepting, whereas $\rho_{13}$ is not. 
	
	Moreover, we use the notation $q_1(i), q_2(i), q_3(i)$ for the states of the run and $k_{12}(i), k_{23}(i), k_{13}(i)$ for the obligations. More specifically for a run $\rho_{ij}$, it is true that $\rho_{ij}(n) = (q_i(n), q_j(n), k_{ij}(n))$.
	
	Let $n_0$ be a position as described in Lemma \ref{lem:fritzwilke:n0_exists} (for $\rho_{13}$) and let $l_j = \min \{ c(q_j(i)) \mid i \geq n_0 \}$ be the lowest priority that $q_j$ reaches after $n_0$.	This is equivalent to $l_j = \min \text{Inf}(\{ c(q_j(i)) \mid i \in \mathbb{N}\})$. We now show that $l_3 \preceq_p l_1$. By Lemma \ref{lem:fritzwilke:run_goodness_implies_de} this gives us $\alpha \in L(\mathcal{A}_\text{de}(q_1, q_3))$, letting us conclude in a contradiction.
	
	\paragraph{Case 1: $l_2$ is even.} We claim that $l_3$ is even and $l_3 \leq l_2$. 
	
	First, to show $l_3 \leq l_2$, let $m \geq n_0$ be a position with $c(q_2(m)) = l_2$ and let $n \geq m$ be the minimal position with $k_{23}(n) = \checkmark$. If $m = n$, then $c(q_3(n)) \preceq_p c(q_2(n)) = l_2$ and therefore $c(q_3(n)) \leq l_2$. Otherwise, from $m$ to $n-1$, $k_{23}$ only grows smaller and is at most $l_2$ (Lemma \ref{lem:fritzwilke:k_shrink}). As the priority of $q_2$ never becomes an odd number smaller than $l_2$, the only way for $k_{23}(m)$ to be $\checkmark$ is that $c(q_3(m))$ is even and $c(q_3(m)) \leq k_{23}(m-1) \leq l_2$.
	
	Second, assume that $l_3$ is odd and let $m$ be a position with $c(q_3(m)) = l_3$. As $l_2$ is even, we have $k_{23}(m) \leq l_3 < l_2$. At no future position can $c(q_3)$ both be even and smaller than $k_{23}$, so $k_{23}$ never becomes $\checkmark$ again. Thus, $\rho_{23}$ is not accepting.
	
	We claim that $l_1$ is odd or $l_1 \geq l_2$.
	
	Towards a contradiction assume the opposite, so $l_1 < l_2$ and $l_1$ is even. Let $m \geq n_0$ be a position with $c(q_1(m)) = l_1$. Then $c(q_2(m)) \not\preceq_p c(q_1(m))$ and therefore $k_{12}(m) = l_1$. At no position after $m$ can it happen that the conditions for $k_{12}$ to become $\checkmark$ again are satisfied. Thus, $\rho_{12}$ would not be accepting.
	
	If $l_1$ is odd and $l_3$ is even, $l_3 \preceq_p l_1$ follows. For the other case, $l_1$ and $l_3$ both being even with $l_3 \leq l_2 \leq l_1$, that also holds.
	
	\paragraph{Case 2: $l_2$ is odd.} We skip the details of this case as it works symmetrically to case 1. In particular, we first show that $l_1$ is odd and $l_1 \leq l_2$. We continue with $l_3$ being even or $l_3 \geq l_2$. From these two statements, $l_3 \preceq_p l_1$ again follows.
\end{proof}

\begin{theorem}
	Let $\mathcal{A}$ be a DPA. Then $\equiv_\text{de}$ is a congruence relation.
\end{theorem}

\begin{proof}
	The three properties that are required for $\equiv_\text{de}$ to be a equivalence relation are rather easy to see. Reflexivity and transitivity have been shown for $\leq_\text{de}$ already and symmetry follows from the definition. Congruence requires more elaboration.

	Let $p \equiv_\text{de} q$ be two equivalent states. Let $a \in \Sigma$ and $p' = \delta(p, a)$ and $q' = \delta(q, a)$. We have to show that also $p' \equiv_\text{de} q'$. Towards a contradiction, assume that $p' \not\leq_\text{de} q'$, so there is a word $\alpha \notin L(\mathcal{A}_\text{de}(p', q'))$. Let $(p', q', k) = \delta_\text{de}((p, q, \checkmark), a)$. By Lemma \ref{lem:fritzwilke:gamma_mono_ext}, the run of $\mathcal{A}_\text{de}$ on $\alpha$ from $(p', q', k)$ cannot be accepting; otherwise, the run of $\mathcal{A}_\text{de}$ from $(p', q', \checkmark)$ would be accepting and $\alpha \in L(\mathcal{A}_\text{de}(p', q'))$. Hence, $a \alpha \notin L(\mathcal{A}_\text{de}(p, q))$, which means that $p \not\equiv_\text{de} q$.
\end{proof}

We want to mention here that $\equiv_\text{de}$ is actually an equivalence relation on APAs as well, as was shown in the original paper. However, congruence is the key point at which deterministic automata diverge. Congruence requires something to be true for \emph{all} successors of a state; delayed simulation only requires there to be \emph{one} equivalent pair of successors. Only in deterministic automata is it that these two coincide.

\begin{cor}
	Let $\mathcal{A}$ be a DPA and $\equiv_\text{de}$ the corresponding delayed simulation-relation. The quotient automaton $\bigslant{\mathcal{A}}{\equiv_\text{de}}$ is well-defined and deterministic.
\end{cor}



\vspace{1cm}
\subsubsection*{Correctness of the quotient}
The quotient automaton itself is used \enquote{only} for state space reduction. The main point of delayed simulation is that the priorities of equivalent states can be made equivalent. 

\begin{theorem}
	Let $\mathcal{A} = (Q, \Sigma, q_0, \delta, c)$ be a DPA. Let $\sim \subseteq Q \times Q$ be a congruence relation such that $p \sim q$ implies $c(p) = c(q)$. Then $L(\mathcal{A}) = L(\bigslant{\mathcal{A}}{\sim})$.
\end{theorem}

\begin{proof}
	Since $\mathcal{A}$ is deterministic and $\sim$ is a congruence relation, $\bigslant{\mathcal{A}}{\sim} = (Q_\sim, \Sigma, [q_0]_\sim, \delta_\sim, c_\sim)$ is deterministic as well. Let $\alpha \in \Sigma^\omega$ be a word and let $\pi$ and $\rho$ be the runs of $\mathcal{A}$ and $\bigslant{\mathcal{A}}{\sim}$. 
		
	For each $i \in \mathbb{N}$, we have $\rho(i) = [\pi(i)]_\sim$ and $c_\sim(\rho(i)) = c(\pi(i))$. Thus, $\text{Inf}(c(\pi)) = \text{Inf}(c(\rho))$ and $\pi$ is accepting iff $\rho$ is accepting.
\end{proof}

\begin{lem}
\label{lem:fritzwilke:equiv_states_same_minpri}
	Let $\mathcal{A}$ be a DPA and let $\pi$ and $\rho$ be runs of $\mathcal{A}$ on the same word but starting at different states. If $\pi(0) \equiv_\text{de} \rho(0)$, then $\min \text{Occ}(c(\pi)) = \min \text{Occ}(c(\rho))$.
\end{lem}

\begin{proof}
	Let $k = \min \text{Occ}(c(\pi))$ and $l = \min \text{Occ}(c(\rho))$. Assume towards a contradiction without loss of generality that $k < l$. Let $\alpha$ be the word that is read by the two runs.
	
	If $k$ is even, let $\sigma$ be the run of $\mathcal{A}_\text{de}(\pi(0), \rho(0))$ on $\alpha$. Let $n$ be a position at which $c(\pi(n)) = k$. We claim that for all $i \geq n$, the third component of $\sigma(i)$ is $k$.
	
	At $\sigma(n)$, this must be true because $k < l \leq c(\rho(n))$ and thus $c(\rho(n)) \not\preceq_p c(\pi(n))$. At all positions after $n$, it can never occur that $c(\rho(i)) \leq k$ or that $c(\pi(i))$ is odd and smaller than $k$. The rest follows from the definition of $\gamma$.
	
	If $k$ is odd, we can argue similarly on the run of $\mathcal{A}_\text{de}(\rho(0), \pi(0))$. As soon as $c(\pi)$ reaches its minimum, the third component of the run will never change again.
\end{proof}

\begin{theorem}
\label{thm:fritzwilke:combine_priorities}
	Let $\mathcal{A} = (Q, \Sigma, q_0, \delta, c)$ be a DPA and let $p, q \in Q$ with $p \equiv_\text{de} q$ and $c(p) < c(q)$. Define $\mathcal{A}' = (Q, \Sigma, q_0, \delta, c')$ with $c'(s) = \begin{cases} c(p) & \text{if } s = q \\ c(s) & \text{else} \end{cases}$. Then $L(\mathcal{A}) = L(\mathcal{A}')$.
\end{theorem}

\begin{proof}
	First, consider the case that $c(p)$ is an even number. The parity of each state is at least as good in $\mathcal{A}'$ as it is in $\mathcal{A}$, so $L(\mathcal{A}) \subseteq L(\mathcal{A}')$. For the other direction, assume there is a $\alpha \in L(\mathcal{A}') \setminus L(\mathcal{A})$, so the respective run $\rho \in Q^\omega$ is accepting in $\mathcal{A}'$ but not in $\mathcal{A}$. 
	
	For this to be true, $\rho$ must visit $q$ infinitely often and $c'(q)$ must be the lowest priority that occurs infinitely often; otherwise, the run would have the same acceptance in both automata. Thus, there is a finite word $w \in \Sigma^*$ such that from $q$, $\mathcal{A}$ reaches again $q$ via $w$ and inbetween only priorities greater than $c'(q)$ are seen.
	
	Now consider the word $w^\omega$ and the run $\pi_q$ of $\mathcal{A}$ on said word starting in $q$. With the argument above, we know that the minimal priority occuring in $c(\pi)$ is greater than $c'(q)$. If we take the run $\pi_p$ on $w^\omega$ starting at $p$ though, we find that this run sees priority $c(p) = c'(q)$ at the very beginning. This contradicts Lemma \ref{lem:fritzwilke:equiv_states_same_minpri}, as $p \equiv_\text{de} q$. Thus, the described $\alpha$ cannot exist. 
	
	If $c(p)$ is an odd number, a very similar argumentation can be applied with the roles of $\mathcal{A}$ and $\mathcal{A}'$ reversed. We omit this repetition.
\end{proof}

\begin{cor}
	For a DPA $\mathcal{A}$, the quotient automaton $\bigslant{\mathcal{A}}{\equiv_\text{de}}$ is a DPA that recognizes the same language.
\end{cor}


\subsection{Using delayed simulation for APAs}
%TODO











